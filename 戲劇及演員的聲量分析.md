
# 戲劇及演員的聲量分析

### 此檔案主要是利用PTT韓劇版的留言，計算近三個月韓劇及韓星的聲量大小

## 1. 匯入需要的套件及讀取自PTT韓劇版上爬下來的json檔


```python
import json

with open("KoreaDrama-2055-2060.json",'r', encoding='utf-8') as f1:
    ptt_kor1 = json.load(f1)
```


```python
with open("KoreaDrama-2061-2065.json",'r', encoding='utf-8') as f2:
    ptt_kor2 = json.load(f2)
```


```python
with open("KoreaDrama-2066-2070.json",'r', encoding='utf-8') as f3:
    ptt_kor3 = json.load(f3)
```


```python
with open("KoreaDrama-2071-2075.json",'r', encoding='utf-8') as f4:
    ptt_kor4 = json.load(f4)
```


```python
with open("KoreaDrama-2076-2080.json",'r', encoding='utf-8') as f5:
    ptt_kor5 = json.load(f5)
```


```python
with open("KoreaDrama-2081-2087.json",'r', encoding='utf-8') as f6:
    ptt_kor6 = json.load(f6)
```


```python
dic_KR=dict(articles= ptt_kor1['articles']+ptt_kor2['articles']+ptt_kor3['articles']+ptt_kor4['articles']+\
            ptt_kor5['articles']+ptt_kor6['articles'])
```


```python
from collections import Counter
from wordcloud import WordCloud
from matplotlib import pyplot as plt
import pandas as pd
import jieba
import matplotlib.pyplot as plt
import operator 
```

## 2. 將json檔轉為DataFrame


```python
article_title_list=[]
date_list=[]
all_count=[]
push_count=[]
boo_count=[]
neutral_count=[]
userid_count=[]
userid_push_count=[]


for i in dic_KR['articles']:
    article_title_list.append(i['article_title'])
    date_list.append(i['date'])
    all_count.append(i['message_count']['all'])
    push_count.append(i['message_count']['push'])
    boo_count.append(i['message_count']['boo'])
    neutral_count.append(i['message_count']['neutral'])
    
    userid=[]
    for j in i['messages']:
        userid.append(j['push_userid'])
    userid_list=list(set(userid))     
    userid_count.append(len(userid_list))
    
    userid_push=[]
    for j in i['messages']:    
        if j['push_tag']=='推':
            userid_push.append(j['push_userid'])
    userid_push_list=list(set(userid_push))         
    userid_push_count.append(len(userid_push_list))
            
```


```python
tbl={
    'article_title':article_title_list,
    'date':date_list,
    'all':all_count,
    'push':push_count,
    'boo':boo_count,
    'neutral':neutral_count,
    'userid_count':userid_count,
    'userid_push_count':userid_push_count 
}

df_tbl=pd.DataFrame(tbl)
```


```python
df_tbl.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>article_title</th>
      <th>date</th>
      <th>all</th>
      <th>push</th>
      <th>boo</th>
      <th>neutral</th>
      <th>userid_count</th>
      <th>userid_push_count</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>[心得] 機智的牢房生活-小迷糊的Happen ending</td>
      <td>Mon Jun  4 00:19:02 2018</td>
      <td>43</td>
      <td>31</td>
      <td>0</td>
      <td>12</td>
      <td>33</td>
      <td>31</td>
    </tr>
    <tr>
      <th>1</th>
      <td>[閒聊] 因為張基龍，久違的心動</td>
      <td>Mon Jun  4 05:41:47 2018</td>
      <td>86</td>
      <td>52</td>
      <td>0</td>
      <td>34</td>
      <td>47</td>
      <td>43</td>
    </tr>
    <tr>
      <th>2</th>
      <td>[新聞] 朴施厚X宋智孝 出演《Lovely Horribly》</td>
      <td>Mon Jun  4 14:11:26 2018</td>
      <td>30</td>
      <td>27</td>
      <td>0</td>
      <td>3</td>
      <td>26</td>
      <td>24</td>
    </tr>
    <tr>
      <th>3</th>
      <td>[LIVE] tvN 想停止的瞬間：About Time EP5</td>
      <td>Mon Jun  4 19:38:37 2018</td>
      <td>102</td>
      <td>31</td>
      <td>0</td>
      <td>71</td>
      <td>19</td>
      <td>15</td>
    </tr>
    <tr>
      <th>4</th>
      <td>[LIVE] 檢法男女 EP13、EP14</td>
      <td>Mon Jun  4 20:27:58 2018</td>
      <td>310</td>
      <td>60</td>
      <td>0</td>
      <td>250</td>
      <td>10</td>
      <td>9</td>
    </tr>
  </tbody>
</table>
</div>




```python
def add_int(row):
    if pd.notnull(row['article_title']):
        row['int'] = 1
    else:
        row['int'] = 0
    return row
df_tbl = df_tbl.apply(add_int, axis=1)
```


```python
df_tbl.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>article_title</th>
      <th>date</th>
      <th>all</th>
      <th>push</th>
      <th>boo</th>
      <th>neutral</th>
      <th>userid_count</th>
      <th>userid_push_count</th>
      <th>int</th>
      <th>title</th>
      <th>actor</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>[心得] 機智的牢房生活-小迷糊的Happen ending</td>
      <td>Mon Jun  4 00:19:02 2018</td>
      <td>43</td>
      <td>31</td>
      <td>0</td>
      <td>12</td>
      <td>33</td>
      <td>31</td>
      <td>1</td>
      <td>無</td>
      <td>無</td>
    </tr>
    <tr>
      <th>1</th>
      <td>[閒聊] 因為張基龍，久違的心動</td>
      <td>Mon Jun  4 05:41:47 2018</td>
      <td>86</td>
      <td>52</td>
      <td>0</td>
      <td>34</td>
      <td>47</td>
      <td>43</td>
      <td>1</td>
      <td>無</td>
      <td>張基龍</td>
    </tr>
    <tr>
      <th>2</th>
      <td>[新聞] 朴施厚X宋智孝 出演《Lovely Horribly》</td>
      <td>Mon Jun  4 14:11:26 2018</td>
      <td>30</td>
      <td>27</td>
      <td>0</td>
      <td>3</td>
      <td>26</td>
      <td>24</td>
      <td>1</td>
      <td>無</td>
      <td>朴施厚</td>
    </tr>
    <tr>
      <th>3</th>
      <td>[LIVE] tvN 想停止的瞬間：About Time EP5</td>
      <td>Mon Jun  4 19:38:37 2018</td>
      <td>102</td>
      <td>31</td>
      <td>0</td>
      <td>71</td>
      <td>19</td>
      <td>15</td>
      <td>1</td>
      <td>想停止的瞬間</td>
      <td>無</td>
    </tr>
    <tr>
      <th>4</th>
      <td>[LIVE] 檢法男女 EP13、EP14</td>
      <td>Mon Jun  4 20:27:58 2018</td>
      <td>310</td>
      <td>60</td>
      <td>0</td>
      <td>250</td>
      <td>10</td>
      <td>9</td>
      <td>1</td>
      <td>檢法男女</td>
      <td>無</td>
    </tr>
  </tbody>
</table>
</div>



## 3. 取出留言的標題及建立韓劇劇名詞庫


```python
article_title_list=df_tbl['article_title'].tolist()
article_title_list[0:10]
```




    ['[心得] 機智的牢房生活-小迷糊的Happen ending',
     '[閒聊] 因為張基龍，久違的心動',
     '[新聞] 朴施厚X宋智孝 出演《Lovely Horribly》',
     '[LIVE] tvN 想停止的瞬間：About Time EP5',
     '[LIVE] 檢法男女 EP13、EP14',
     '[LIVE] SBS 油膩的Melo EP17~18',
     '[LIVE] KBS2 你也是人類嗎? EP1~2',
     '[LIVE] JTBC 漢摩拉比小姐 EP5',
     '[新聞] 《你也是人類嗎》首播收視墊底 《檢法男',
     '[新聞] 千正明有望合作尹恩惠 出演新劇《心動警']




```python
DramaName=pd.read_csv('userdict.csv', encoding='utf-8')
DramaName_list=DramaName['dramaName'].tolist()
DramaName_list[0:10]
```




    ['1006的房客',
     '1006',
     '16個夏天',
     '1989一念間',
     '700歲旅程',
     'A咖的路',
     'High 5 制霸青春',
     'High5 ',
     '制霸青春',
     'HIStory']



## 4. 利用結巴搭配韓劇劇名詞庫，對留言標題進行斷詞


```python
jieba.load_userdict("userdict.txt")
with open('stops.txt', 'r', encoding='utf8') as f:
    stops = f.read().split('\n')

stops.append('\n')
stops.append('\n\n')
```

    Building prefix dict from the default dictionary ...
    Dumping model to file cache C:\Users\mintz\AppData\Local\Temp\jieba.cache
    Loading model cost 1.162 seconds.
    Prefix dict has been built succesfully.
    


```python
info_all=[]
terms_list=[]

for articleTitle in article_title_list:

    terms = [t for t in jieba.cut_for_search(articleTitle) if t not in stops]
    terms_list.append(terms)
        
    
for term in terms_list:
    title_list=[]
    for i in term:
        if i in DramaName_list:
            title_list.append(i)
    if len(title_list)==0:
        info_all.append('無')
    if len(title_list)>0:
        info_all.append(title_list[0])
```


```python
df_tbl['title']=info_all
df_tbl.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>article_title</th>
      <th>date</th>
      <th>all</th>
      <th>push</th>
      <th>boo</th>
      <th>neutral</th>
      <th>userid_count</th>
      <th>userid_push_count</th>
      <th>int</th>
      <th>title</th>
      <th>actor</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>[心得] 機智的牢房生活-小迷糊的Happen ending</td>
      <td>Mon Jun  4 00:19:02 2018</td>
      <td>43</td>
      <td>31</td>
      <td>0</td>
      <td>12</td>
      <td>33</td>
      <td>31</td>
      <td>1</td>
      <td>無</td>
      <td>無</td>
    </tr>
    <tr>
      <th>1</th>
      <td>[閒聊] 因為張基龍，久違的心動</td>
      <td>Mon Jun  4 05:41:47 2018</td>
      <td>86</td>
      <td>52</td>
      <td>0</td>
      <td>34</td>
      <td>47</td>
      <td>43</td>
      <td>1</td>
      <td>無</td>
      <td>張基龍</td>
    </tr>
    <tr>
      <th>2</th>
      <td>[新聞] 朴施厚X宋智孝 出演《Lovely Horribly》</td>
      <td>Mon Jun  4 14:11:26 2018</td>
      <td>30</td>
      <td>27</td>
      <td>0</td>
      <td>3</td>
      <td>26</td>
      <td>24</td>
      <td>1</td>
      <td>無</td>
      <td>朴施厚</td>
    </tr>
    <tr>
      <th>3</th>
      <td>[LIVE] tvN 想停止的瞬間：About Time EP5</td>
      <td>Mon Jun  4 19:38:37 2018</td>
      <td>102</td>
      <td>31</td>
      <td>0</td>
      <td>71</td>
      <td>19</td>
      <td>15</td>
      <td>1</td>
      <td>想停止的瞬間</td>
      <td>無</td>
    </tr>
    <tr>
      <th>4</th>
      <td>[LIVE] 檢法男女 EP13、EP14</td>
      <td>Mon Jun  4 20:27:58 2018</td>
      <td>310</td>
      <td>60</td>
      <td>0</td>
      <td>250</td>
      <td>10</td>
      <td>9</td>
      <td>1</td>
      <td>檢法男女</td>
      <td>無</td>
    </tr>
  </tbody>
</table>
</div>




```python
df_kor=df_tbl.replace(['武法律師', '油膩的', '金秘書', '你的管家', 'Sunshine', 'Mr.Sunshine', '一起吃飯吧', '江南美人', 'Signal', 'abouttime'], \
               ['無法律師', '油膩的Melo', '金秘書為何那樣', '妳的管家','陽光先生', '陽光先生', '一起吃飯吧3', '我的ID是江南美人', '信號', '想停止的瞬間'])
```


```python
df_kor.to_csv('df_kor_drama.csv', encoding='utf-8')
df_kor.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>article_title</th>
      <th>date</th>
      <th>all</th>
      <th>push</th>
      <th>boo</th>
      <th>neutral</th>
      <th>userid_count</th>
      <th>userid_push_count</th>
      <th>int</th>
      <th>title</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>[心得] 機智的牢房生活-小迷糊的Happen ending</td>
      <td>Mon Jun  4 00:19:02 2018</td>
      <td>43</td>
      <td>31</td>
      <td>0</td>
      <td>12</td>
      <td>33</td>
      <td>31</td>
      <td>1</td>
      <td>無</td>
    </tr>
    <tr>
      <th>1</th>
      <td>[閒聊] 因為張基龍，久違的心動</td>
      <td>Mon Jun  4 05:41:47 2018</td>
      <td>86</td>
      <td>52</td>
      <td>0</td>
      <td>34</td>
      <td>47</td>
      <td>43</td>
      <td>1</td>
      <td>無</td>
    </tr>
    <tr>
      <th>2</th>
      <td>[新聞] 朴施厚X宋智孝 出演《Lovely Horribly》</td>
      <td>Mon Jun  4 14:11:26 2018</td>
      <td>30</td>
      <td>27</td>
      <td>0</td>
      <td>3</td>
      <td>26</td>
      <td>24</td>
      <td>1</td>
      <td>無</td>
    </tr>
    <tr>
      <th>3</th>
      <td>[LIVE] tvN 想停止的瞬間：About Time EP5</td>
      <td>Mon Jun  4 19:38:37 2018</td>
      <td>102</td>
      <td>31</td>
      <td>0</td>
      <td>71</td>
      <td>19</td>
      <td>15</td>
      <td>1</td>
      <td>想停止的瞬間</td>
    </tr>
    <tr>
      <th>4</th>
      <td>[LIVE] 檢法男女 EP13、EP14</td>
      <td>Mon Jun  4 20:27:58 2018</td>
      <td>310</td>
      <td>60</td>
      <td>0</td>
      <td>250</td>
      <td>10</td>
      <td>9</td>
      <td>1</td>
      <td>檢法男女</td>
    </tr>
  </tbody>
</table>
</div>



## 5. 整理可判斷出戲劇劇名的留言，並且處理留言時間欄位


```python
df_kor_withTitle=df_kor[df_kor['title']!='無']
```


```python
df_list=df_kor_withTitle['date'].tolist()

month_list=[]
day_list=[]
year_list=[]
for i in df_list:
    year_list.append(i.split()[4])
    month_list.append(i.split()[1])
    day_list.append(i.split()[2])
```


```python
df_kor_withTitle['year']=year_list
df_kor_withTitle['month']=month_list
df_kor_withTitle['day']=day_list
df_kor_withTitle1=df_kor_withTitle.replace(['Jun', 'Jul', 'Aug', '1', '2', '3','4', '5', '6', '7', '8', '9'], \
                                           ['6', '7', '8','01', '02', '03', '04', '05', '06', '07', '08', '09'])
df_kor_withTitle1['date1']=df_kor_withTitle1['year']+'/'+df_kor_withTitle1['month']+'/'+df_kor_withTitle1['day']
df_kor_withTitle1.to_csv('df_kor_drama_date.csv', encoding='utf-8')
df_kor_withTitle1.head(10)
```

    C:\Anaconda3\lib\site-packages\ipykernel_launcher.py:1: SettingWithCopyWarning: 
    A value is trying to be set on a copy of a slice from a DataFrame.
    Try using .loc[row_indexer,col_indexer] = value instead
    
    See the caveats in the documentation: http://pandas.pydata.org/pandas-docs/stable/indexing.html#indexing-view-versus-copy
      """Entry point for launching an IPython kernel.
    C:\Anaconda3\lib\site-packages\ipykernel_launcher.py:2: SettingWithCopyWarning: 
    A value is trying to be set on a copy of a slice from a DataFrame.
    Try using .loc[row_indexer,col_indexer] = value instead
    
    See the caveats in the documentation: http://pandas.pydata.org/pandas-docs/stable/indexing.html#indexing-view-versus-copy
      
    C:\Anaconda3\lib\site-packages\ipykernel_launcher.py:3: SettingWithCopyWarning: 
    A value is trying to be set on a copy of a slice from a DataFrame.
    Try using .loc[row_indexer,col_indexer] = value instead
    
    See the caveats in the documentation: http://pandas.pydata.org/pandas-docs/stable/indexing.html#indexing-view-versus-copy
      This is separate from the ipykernel package so we can avoid doing imports until
    




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>article_title</th>
      <th>date</th>
      <th>all</th>
      <th>push</th>
      <th>boo</th>
      <th>neutral</th>
      <th>userid_count</th>
      <th>userid_push_count</th>
      <th>int</th>
      <th>title</th>
      <th>year</th>
      <th>month</th>
      <th>day</th>
      <th>date1</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>3</th>
      <td>[LIVE] tvN 想停止的瞬間：About Time EP5</td>
      <td>Mon Jun  4 19:38:37 2018</td>
      <td>102</td>
      <td>31</td>
      <td>0</td>
      <td>71</td>
      <td>19</td>
      <td>15</td>
      <td>1</td>
      <td>想停止的瞬間</td>
      <td>2018</td>
      <td>06</td>
      <td>04</td>
      <td>2018/06/04</td>
    </tr>
    <tr>
      <th>4</th>
      <td>[LIVE] 檢法男女 EP13、EP14</td>
      <td>Mon Jun  4 20:27:58 2018</td>
      <td>310</td>
      <td>60</td>
      <td>0</td>
      <td>250</td>
      <td>10</td>
      <td>9</td>
      <td>1</td>
      <td>檢法男女</td>
      <td>2018</td>
      <td>06</td>
      <td>04</td>
      <td>2018/06/04</td>
    </tr>
    <tr>
      <th>5</th>
      <td>[LIVE] SBS 油膩的Melo EP17~18</td>
      <td>Mon Jun  4 20:29:20 2018</td>
      <td>354</td>
      <td>123</td>
      <td>0</td>
      <td>231</td>
      <td>18</td>
      <td>16</td>
      <td>1</td>
      <td>油膩的Melo</td>
      <td>2018</td>
      <td>06</td>
      <td>04</td>
      <td>2018/06/04</td>
    </tr>
    <tr>
      <th>6</th>
      <td>[LIVE] KBS2 你也是人類嗎? EP1~2</td>
      <td>Mon Jun  4 20:29:58 2018</td>
      <td>98</td>
      <td>70</td>
      <td>0</td>
      <td>28</td>
      <td>32</td>
      <td>29</td>
      <td>1</td>
      <td>你也是人類嗎</td>
      <td>2018</td>
      <td>06</td>
      <td>04</td>
      <td>2018/06/04</td>
    </tr>
    <tr>
      <th>7</th>
      <td>[LIVE] JTBC 漢摩拉比小姐 EP5</td>
      <td>Mon Jun  4 21:07:06 2018</td>
      <td>440</td>
      <td>161</td>
      <td>0</td>
      <td>279</td>
      <td>30</td>
      <td>28</td>
      <td>1</td>
      <td>漢摩拉比小姐</td>
      <td>2018</td>
      <td>06</td>
      <td>04</td>
      <td>2018/06/04</td>
    </tr>
    <tr>
      <th>8</th>
      <td>[新聞] 《你也是人類嗎》首播收視墊底 《檢法男</td>
      <td>Tue Jun  5 11:34:52 2018</td>
      <td>42</td>
      <td>24</td>
      <td>0</td>
      <td>18</td>
      <td>21</td>
      <td>19</td>
      <td>1</td>
      <td>你也是人類嗎</td>
      <td>2018</td>
      <td>06</td>
      <td>05</td>
      <td>2018/06/05</td>
    </tr>
    <tr>
      <th>12</th>
      <td>[新聞] 《一起吃飯吧3》公開劇本練習現場</td>
      <td>Tue Jun  5 15:32:36 2018</td>
      <td>42</td>
      <td>39</td>
      <td>0</td>
      <td>3</td>
      <td>39</td>
      <td>37</td>
      <td>1</td>
      <td>一起吃飯吧3</td>
      <td>2018</td>
      <td>06</td>
      <td>05</td>
      <td>2018/06/05</td>
    </tr>
    <tr>
      <th>13</th>
      <td>[LIVE] tvN 想停止的瞬間：About Time EP6</td>
      <td>Tue Jun  5 19:47:46 2018</td>
      <td>167</td>
      <td>67</td>
      <td>0</td>
      <td>100</td>
      <td>33</td>
      <td>30</td>
      <td>1</td>
      <td>想停止的瞬間</td>
      <td>2018</td>
      <td>06</td>
      <td>05</td>
      <td>2018/06/05</td>
    </tr>
    <tr>
      <th>14</th>
      <td>[LIVE] SBS 油膩的Melo EP19~20</td>
      <td>Tue Jun  5 20:35:35 2018</td>
      <td>294</td>
      <td>170</td>
      <td>1</td>
      <td>123</td>
      <td>46</td>
      <td>43</td>
      <td>1</td>
      <td>油膩的Melo</td>
      <td>2018</td>
      <td>06</td>
      <td>05</td>
      <td>2018/06/05</td>
    </tr>
    <tr>
      <th>15</th>
      <td>[LIVE] KBS2 你也是人類嗎? EP3~4</td>
      <td>Tue Jun  5 20:35:58 2018</td>
      <td>193</td>
      <td>107</td>
      <td>0</td>
      <td>86</td>
      <td>25</td>
      <td>20</td>
      <td>1</td>
      <td>你也是人類嗎</td>
      <td>2018</td>
      <td>06</td>
      <td>05</td>
      <td>2018/06/05</td>
    </tr>
  </tbody>
</table>
</div>




```python
df_kor1=df_kor_withTitle1.groupby(['title']).sum().sort_values('userid_push_count', ascending=False)
df_kor1.head(10)
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>all</th>
      <th>push</th>
      <th>boo</th>
      <th>neutral</th>
      <th>userid_count</th>
      <th>userid_push_count</th>
      <th>int</th>
    </tr>
    <tr>
      <th>title</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>金秘書為何那樣</th>
      <td>14158</td>
      <td>8658</td>
      <td>4</td>
      <td>5496</td>
      <td>4074</td>
      <td>3862</td>
      <td>68</td>
    </tr>
    <tr>
      <th>火星生活</th>
      <td>6080</td>
      <td>2745</td>
      <td>5</td>
      <td>3330</td>
      <td>1130</td>
      <td>1065</td>
      <td>31</td>
    </tr>
    <tr>
      <th>陽光先生</th>
      <td>8057</td>
      <td>3502</td>
      <td>5</td>
      <td>4550</td>
      <td>1103</td>
      <td>965</td>
      <td>33</td>
    </tr>
    <tr>
      <th>我的ID是江南美人</th>
      <td>1816</td>
      <td>1083</td>
      <td>0</td>
      <td>733</td>
      <td>821</td>
      <td>776</td>
      <td>11</td>
    </tr>
    <tr>
      <th>一起吃飯吧3</th>
      <td>1826</td>
      <td>1191</td>
      <td>1</td>
      <td>634</td>
      <td>766</td>
      <td>718</td>
      <td>20</td>
    </tr>
    <tr>
      <th>漢摩拉比小姐</th>
      <td>4674</td>
      <td>1911</td>
      <td>1</td>
      <td>2762</td>
      <td>729</td>
      <td>667</td>
      <td>27</td>
    </tr>
    <tr>
      <th>你也是人類嗎</th>
      <td>3154</td>
      <td>1724</td>
      <td>0</td>
      <td>1430</td>
      <td>616</td>
      <td>567</td>
      <td>27</td>
    </tr>
    <tr>
      <th>雖然30但仍17</th>
      <td>2293</td>
      <td>889</td>
      <td>0</td>
      <td>1404</td>
      <td>548</td>
      <td>511</td>
      <td>18</td>
    </tr>
    <tr>
      <th>過來抱抱我</th>
      <td>2856</td>
      <td>1369</td>
      <td>0</td>
      <td>1487</td>
      <td>517</td>
      <td>492</td>
      <td>21</td>
    </tr>
    <tr>
      <th>我的大叔</th>
      <td>852</td>
      <td>468</td>
      <td>0</td>
      <td>384</td>
      <td>399</td>
      <td>375</td>
      <td>14</td>
    </tr>
  </tbody>
</table>
</div>




```python
df_kor1_drama_r=df_kor1.reset_index()
df_kor1_drama_r.to_csv('df_kor_drama_r.csv', encoding='utf-8')
df_kor1_drama_r.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>title</th>
      <th>all</th>
      <th>push</th>
      <th>boo</th>
      <th>neutral</th>
      <th>userid_count</th>
      <th>userid_push_count</th>
      <th>int</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>金秘書為何那樣</td>
      <td>14158</td>
      <td>8658</td>
      <td>4</td>
      <td>5496</td>
      <td>4074</td>
      <td>3862</td>
      <td>68</td>
    </tr>
    <tr>
      <th>1</th>
      <td>火星生活</td>
      <td>6080</td>
      <td>2745</td>
      <td>5</td>
      <td>3330</td>
      <td>1130</td>
      <td>1065</td>
      <td>31</td>
    </tr>
    <tr>
      <th>2</th>
      <td>陽光先生</td>
      <td>8057</td>
      <td>3502</td>
      <td>5</td>
      <td>4550</td>
      <td>1103</td>
      <td>965</td>
      <td>33</td>
    </tr>
    <tr>
      <th>3</th>
      <td>我的ID是江南美人</td>
      <td>1816</td>
      <td>1083</td>
      <td>0</td>
      <td>733</td>
      <td>821</td>
      <td>776</td>
      <td>11</td>
    </tr>
    <tr>
      <th>4</th>
      <td>一起吃飯吧3</td>
      <td>1826</td>
      <td>1191</td>
      <td>1</td>
      <td>634</td>
      <td>766</td>
      <td>718</td>
      <td>20</td>
    </tr>
  </tbody>
</table>
</div>



## 6. 畫出某部戲劇的聲量時間序列


```python
d2=df_kor_withTitle1.groupby(['title', 'date1']).sum()
d3=d2.reset_index()
d4=d3.sort_values(['title', 'date1'])
plt.figure(figsize=(30,12))
plt.xticks(rotation=45)

dramaName='金秘書為何那樣'
d5 = d4[d4['title'] == dramaName]
plt.plot(d5['date1'], d5["userid_push_count"], color='green', label=dramaName)


plt.legend()
plt.show()
```


![png](output_33_0.png)


## 7. 製作戲劇聲量雲


```python
dic_kor={}
df_kor2=df_kor1.reset_index()
df_title=df_kor2['title'].tolist()
df_num=df_kor2['userid_push_count'].tolist()

for i in range(len(df_num)):
    dic_kor[df_title[i]]=df_num[i]

kor_list=[]  
for i in df_title:
    tu=(i, dic_kor[i])
    kor_list.append(tu)

kor_list[0:3]
```




    [('金秘書為何那樣', 3862), ('火星生活', 1065), ('陽光先生', 965)]




```python
kor_cloud=[]

for i in range(len(df_num)):
    for j in range(df_num[i]):
        kor_cloud.append(df_title[i])
```


```python
wordcloud = WordCloud(font_path='SimSun.ttf')
# wl_space_split = ",".join(kor_cloud)
wordcloud.generate_from_frequencies(frequencies=Counter(kor_cloud))
# my_wordcloud = wc.generate(wl_space_split)
plt.figure(figsize=(15,15))
plt.imshow(wordcloud, interpolation="bilinear")
plt.axis("off")
plt.show()
```


![png](output_37_0.png)


## 8. 建立韓劇演員詞庫


```python
ActorName=pd.read_csv('userdict2.csv', encoding='utf-8')
ActorName_list=ActorName['actorName'].tolist()
ActorName_list[0:3]
```




    ['李英愛', '宋承憲', '吳允兒']



## 9. 利用結巴搭配韓劇演員詞庫，對留言標題進行斷詞


```python
jieba.load_userdict("userdict2.txt")
with open('stops.txt', 'r', encoding='utf8') as f:
    stops = f.read().split('\n')

stops.append('\n')
stops.append('\n\n')
```


```python
info_all_a=[]
terms_list_a=[]

for articleTitle in article_title_list:

    terms_a = [t for t in jieba.cut_for_search(articleTitle) if t not in stops]
    terms_list_a.append(terms_a)
        
    
for term in terms_list_a:
    title_list_a=[]
    for i in term:
        if i in ActorName_list:
            title_list_a.append(i)
    if len(title_list_a)==0:
        info_all_a.append('無')
    if len(title_list_a)>0:
        info_all_a.append(title_list_a[0])
```


```python
df_tbl['actor']=info_all_a
df_tbl.to_csv('df_kor_actor.csv', encoding='utf-8')
df_kor_a=df_tbl
df_kor_a.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>article_title</th>
      <th>date</th>
      <th>all</th>
      <th>push</th>
      <th>boo</th>
      <th>neutral</th>
      <th>userid_count</th>
      <th>userid_push_count</th>
      <th>int</th>
      <th>title</th>
      <th>actor</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>[心得] 機智的牢房生活-小迷糊的Happen ending</td>
      <td>Mon Jun  4 00:19:02 2018</td>
      <td>43</td>
      <td>31</td>
      <td>0</td>
      <td>12</td>
      <td>33</td>
      <td>31</td>
      <td>1</td>
      <td>無</td>
      <td>無</td>
    </tr>
    <tr>
      <th>1</th>
      <td>[閒聊] 因為張基龍，久違的心動</td>
      <td>Mon Jun  4 05:41:47 2018</td>
      <td>86</td>
      <td>52</td>
      <td>0</td>
      <td>34</td>
      <td>47</td>
      <td>43</td>
      <td>1</td>
      <td>無</td>
      <td>張基龍</td>
    </tr>
    <tr>
      <th>2</th>
      <td>[新聞] 朴施厚X宋智孝 出演《Lovely Horribly》</td>
      <td>Mon Jun  4 14:11:26 2018</td>
      <td>30</td>
      <td>27</td>
      <td>0</td>
      <td>3</td>
      <td>26</td>
      <td>24</td>
      <td>1</td>
      <td>無</td>
      <td>朴施厚</td>
    </tr>
    <tr>
      <th>3</th>
      <td>[LIVE] tvN 想停止的瞬間：About Time EP5</td>
      <td>Mon Jun  4 19:38:37 2018</td>
      <td>102</td>
      <td>31</td>
      <td>0</td>
      <td>71</td>
      <td>19</td>
      <td>15</td>
      <td>1</td>
      <td>想停止的瞬間</td>
      <td>無</td>
    </tr>
    <tr>
      <th>4</th>
      <td>[LIVE] 檢法男女 EP13、EP14</td>
      <td>Mon Jun  4 20:27:58 2018</td>
      <td>310</td>
      <td>60</td>
      <td>0</td>
      <td>250</td>
      <td>10</td>
      <td>9</td>
      <td>1</td>
      <td>檢法男女</td>
      <td>無</td>
    </tr>
  </tbody>
</table>
</div>



## 10.整理可判斷出戲劇演員的留言，並且處理留言時間欄位


```python
df_kor_withTitle_a=df_kor_a[df_kor_a['actor']!='無']
```


```python
df_list_a=df_kor_withTitle_a['date'].tolist()

month_list_a=[]
day_list_a=[]
year_list_a=[]
for i in df_list_a:
    year_list_a.append(i.split()[4])
    month_list_a.append(i.split()[1])
    day_list_a.append(i.split()[2])
```


```python
df_kor_withTitle_a['year']=year_list_a
df_kor_withTitle_a['month']=month_list_a
df_kor_withTitle_a['day']=day_list_a
df_kor_withTitle1_a=df_kor_withTitle_a.replace(['Jun', 'Jul', 'Aug', '1', '2', '3','4', '5', '6', '7', '8', '9'], \
                                           ['6', '7', '8','01', '02', '03', '04', '05', '06', '07', '08', '09'])
df_kor_withTitle1_a['date1']=df_kor_withTitle1_a['year']+'/'+df_kor_withTitle1_a['month']+'/'+df_kor_withTitle1_a['day']
df_kor_withTitle1_a.to_csv('df_kor_actor_date.csv', encoding='utf-8')
df_kor_withTitle1_a.head(10)
```

    C:\Anaconda3\lib\site-packages\ipykernel_launcher.py:1: SettingWithCopyWarning: 
    A value is trying to be set on a copy of a slice from a DataFrame.
    Try using .loc[row_indexer,col_indexer] = value instead
    
    See the caveats in the documentation: http://pandas.pydata.org/pandas-docs/stable/indexing.html#indexing-view-versus-copy
      """Entry point for launching an IPython kernel.
    C:\Anaconda3\lib\site-packages\ipykernel_launcher.py:2: SettingWithCopyWarning: 
    A value is trying to be set on a copy of a slice from a DataFrame.
    Try using .loc[row_indexer,col_indexer] = value instead
    
    See the caveats in the documentation: http://pandas.pydata.org/pandas-docs/stable/indexing.html#indexing-view-versus-copy
      
    C:\Anaconda3\lib\site-packages\ipykernel_launcher.py:3: SettingWithCopyWarning: 
    A value is trying to be set on a copy of a slice from a DataFrame.
    Try using .loc[row_indexer,col_indexer] = value instead
    
    See the caveats in the documentation: http://pandas.pydata.org/pandas-docs/stable/indexing.html#indexing-view-versus-copy
      This is separate from the ipykernel package so we can avoid doing imports until
    




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>article_title</th>
      <th>date</th>
      <th>all</th>
      <th>push</th>
      <th>boo</th>
      <th>neutral</th>
      <th>userid_count</th>
      <th>userid_push_count</th>
      <th>int</th>
      <th>title</th>
      <th>actor</th>
      <th>year</th>
      <th>month</th>
      <th>day</th>
      <th>date1</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>[閒聊] 因為張基龍，久違的心動</td>
      <td>Mon Jun  4 05:41:47 2018</td>
      <td>86</td>
      <td>52</td>
      <td>0</td>
      <td>34</td>
      <td>47</td>
      <td>43</td>
      <td>1</td>
      <td>無</td>
      <td>張基龍</td>
      <td>2018</td>
      <td>06</td>
      <td>04</td>
      <td>2018/06/04</td>
    </tr>
    <tr>
      <th>2</th>
      <td>[新聞] 朴施厚X宋智孝 出演《Lovely Horribly》</td>
      <td>Mon Jun  4 14:11:26 2018</td>
      <td>30</td>
      <td>27</td>
      <td>0</td>
      <td>3</td>
      <td>26</td>
      <td>24</td>
      <td>1</td>
      <td>無</td>
      <td>朴施厚</td>
      <td>2018</td>
      <td>06</td>
      <td>04</td>
      <td>2018/06/04</td>
    </tr>
    <tr>
      <th>9</th>
      <td>[新聞] 千正明有望合作尹恩惠 出演新劇《心動警</td>
      <td>Tue Jun  5 11:39:33 2018</td>
      <td>18</td>
      <td>10</td>
      <td>0</td>
      <td>8</td>
      <td>13</td>
      <td>10</td>
      <td>1</td>
      <td>無</td>
      <td>尹恩惠</td>
      <td>2018</td>
      <td>06</td>
      <td>05</td>
      <td>2018/06/05</td>
    </tr>
    <tr>
      <th>10</th>
      <td>[新聞] 李清娥、洪宗玄確認出演《再一次，春天》</td>
      <td>Tue Jun  5 14:25:53 2018</td>
      <td>30</td>
      <td>20</td>
      <td>0</td>
      <td>10</td>
      <td>25</td>
      <td>20</td>
      <td>1</td>
      <td>無</td>
      <td>李清娥</td>
      <td>2018</td>
      <td>06</td>
      <td>05</td>
      <td>2018/06/05</td>
    </tr>
    <tr>
      <th>29</th>
      <td>[情報] 曹承佑、李棟旭《LIFE》二支預告公開</td>
      <td>Thu Jun  7 13:14:15 2018</td>
      <td>78</td>
      <td>63</td>
      <td>0</td>
      <td>15</td>
      <td>59</td>
      <td>54</td>
      <td>1</td>
      <td>無</td>
      <td>李棟旭</td>
      <td>2018</td>
      <td>06</td>
      <td>07</td>
      <td>2018/06/07</td>
    </tr>
    <tr>
      <th>34</th>
      <td>[閒聊] 熬很久才當上女主角的藝人-申惠善</td>
      <td>Fri Jun  8 02:02:36 2018</td>
      <td>132</td>
      <td>56</td>
      <td>1</td>
      <td>75</td>
      <td>54</td>
      <td>50</td>
      <td>1</td>
      <td>無</td>
      <td>申惠善</td>
      <td>2018</td>
      <td>06</td>
      <td>08</td>
      <td>2018/06/08</td>
    </tr>
    <tr>
      <th>35</th>
      <td>[新聞] 尹均相加入《清掃吧》 與金裕貞等合作</td>
      <td>Fri Jun  8 09:05:59 2018</td>
      <td>51</td>
      <td>38</td>
      <td>0</td>
      <td>13</td>
      <td>40</td>
      <td>35</td>
      <td>1</td>
      <td>無</td>
      <td>尹均相</td>
      <td>2018</td>
      <td>06</td>
      <td>08</td>
      <td>2018/06/08</td>
    </tr>
    <tr>
      <th>56</th>
      <td>[新聞] SBS新劇男主圈定金南佶 公司稱在商討出演</td>
      <td>Mon Jun 11 11:52:03 2018</td>
      <td>40</td>
      <td>37</td>
      <td>0</td>
      <td>3</td>
      <td>40</td>
      <td>37</td>
      <td>1</td>
      <td>無</td>
      <td>金南佶</td>
      <td>2018</td>
      <td>06</td>
      <td>11</td>
      <td>2018/06/11</td>
    </tr>
    <tr>
      <th>80</th>
      <td>[情報] 河錫辰《你的管家》2支印象預告公開</td>
      <td>Wed Jun 13 10:08:55 2018</td>
      <td>45</td>
      <td>40</td>
      <td>0</td>
      <td>5</td>
      <td>33</td>
      <td>32</td>
      <td>1</td>
      <td>你的管家</td>
      <td>河錫辰</td>
      <td>2018</td>
      <td>06</td>
      <td>13</td>
      <td>2018/06/13</td>
    </tr>
    <tr>
      <th>90</th>
      <td>[新聞] 《金裝律師》今晚終映 高聖熙提前表感受</td>
      <td>Thu Jun 14 09:46:58 2018</td>
      <td>9</td>
      <td>6</td>
      <td>0</td>
      <td>3</td>
      <td>7</td>
      <td>6</td>
      <td>1</td>
      <td>金裝律師</td>
      <td>高聖熙</td>
      <td>2018</td>
      <td>06</td>
      <td>14</td>
      <td>2018/06/14</td>
    </tr>
  </tbody>
</table>
</div>




```python
df_kor1_a=df_kor_withTitle1_a.groupby(['actor']).sum().sort_values('userid_push_count', ascending=False)
df_kor1_a.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>all</th>
      <th>push</th>
      <th>boo</th>
      <th>neutral</th>
      <th>userid_count</th>
      <th>userid_push_count</th>
      <th>int</th>
    </tr>
    <tr>
      <th>actor</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>宋慧喬</th>
      <td>287</td>
      <td>184</td>
      <td>2</td>
      <td>101</td>
      <td>184</td>
      <td>158</td>
      <td>1</td>
    </tr>
    <tr>
      <th>朴敘俊</th>
      <td>184</td>
      <td>145</td>
      <td>0</td>
      <td>39</td>
      <td>137</td>
      <td>132</td>
      <td>2</td>
    </tr>
    <tr>
      <th>李民基</th>
      <td>169</td>
      <td>150</td>
      <td>0</td>
      <td>19</td>
      <td>137</td>
      <td>129</td>
      <td>2</td>
    </tr>
    <tr>
      <th>池昌旭</th>
      <td>187</td>
      <td>135</td>
      <td>0</td>
      <td>52</td>
      <td>129</td>
      <td>126</td>
      <td>1</td>
    </tr>
    <tr>
      <th>池晟</th>
      <td>137</td>
      <td>120</td>
      <td>0</td>
      <td>17</td>
      <td>120</td>
      <td>114</td>
      <td>4</td>
    </tr>
  </tbody>
</table>
</div>




```python
df_kor1_actor_r=df_kor1_a.reset_index()
df_kor1_actor_r.to_csv('df_kor_actor_r.csv', encoding='utf-8')
df_kor1_actor_r.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>actor</th>
      <th>all</th>
      <th>push</th>
      <th>boo</th>
      <th>neutral</th>
      <th>userid_count</th>
      <th>userid_push_count</th>
      <th>int</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>宋慧喬</td>
      <td>287</td>
      <td>184</td>
      <td>2</td>
      <td>101</td>
      <td>184</td>
      <td>158</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>朴敘俊</td>
      <td>184</td>
      <td>145</td>
      <td>0</td>
      <td>39</td>
      <td>137</td>
      <td>132</td>
      <td>2</td>
    </tr>
    <tr>
      <th>2</th>
      <td>李民基</td>
      <td>169</td>
      <td>150</td>
      <td>0</td>
      <td>19</td>
      <td>137</td>
      <td>129</td>
      <td>2</td>
    </tr>
    <tr>
      <th>3</th>
      <td>池昌旭</td>
      <td>187</td>
      <td>135</td>
      <td>0</td>
      <td>52</td>
      <td>129</td>
      <td>126</td>
      <td>1</td>
    </tr>
    <tr>
      <th>4</th>
      <td>池晟</td>
      <td>137</td>
      <td>120</td>
      <td>0</td>
      <td>17</td>
      <td>120</td>
      <td>114</td>
      <td>4</td>
    </tr>
  </tbody>
</table>
</div>



## 11.製作戲劇聲量雲


```python
dic_kor_a={}
df_kor2_a=df_kor1_a.reset_index()
df_actor=df_kor2_a['actor'].tolist()
df_num_a=df_kor2_a['userid_push_count'].tolist()

for i in range(len(df_num_a)):
    dic_kor_a[df_actor[i]]=df_num_a[i]

kor_list_a=[]  
for i in df_actor:
    tu_a=(i, dic_kor_a[i])
    kor_list_a.append(tu_a)

kor_list_a[0:3]
```




    [('宋慧喬', 158), ('朴敘俊', 132), ('李民基', 129)]




```python
kor_cloud_a=[]

for i in range(len(df_num_a)):
    for j in range(df_num_a[i]):
        kor_cloud_a.append(df_actor[i])
```


```python
wordcloud = WordCloud(font_path='SimSun.ttf')
# wl_space_split = ",".join(kor_cloud)
wordcloud.generate_from_frequencies(frequencies=Counter(kor_cloud_a))
# my_wordcloud = wc.generate(wl_space_split)
plt.figure(figsize=(15,15))
plt.imshow(wordcloud, interpolation="bilinear")
plt.axis("off")
plt.show()
```


![png](output_53_0.png)

